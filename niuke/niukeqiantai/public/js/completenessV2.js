define("nowcoder/1.2.348/javascripts/site/login/completenessV2",["../../lib/jquery","../../core/base","../../lib/underscore","../../util/util","../../util/cookie","../../action/login","../../util/ajax","../../core/siteConfig","../../action/profile","../../component/input","../../util/dom","../../util/browser","../../core/component","../../util/event","../../component/popup","../../component/layer","../../util/dragdrop","../../util/avatarUpload","../../util/upload","../../lib/swfupload","../../component/avatarDialog"],function(a){function b(){var a=this;a.headIpt=g("#headIpt"),a.nameIpt=g("#nameIpt"),a.emailIpt=g("#emailIpt"),a.needEmailOrPhone=a.emailIpt.length>0,a.info={},a.initNameIpt(),a.initEmailIpt(),a.initAvatar()}function c(){var a=this;a.nameItem=l.transform(a.nameIpt.parent(),{focus:function(){var a=this;a.none()},blur:function(){var b=this,c=g.trim(b.val());b[""===c?"error":"none"](),a.info.name=c}})}function d(){var a=this;a.needEmailOrPhone&&(a.emailItem=l.transform(a.emailIpt.parent(),{blur:function(){var b=this,c=g.trim(b.val());return i.isEmail(c)||i.isPhone(c)?(a.info.email=c,void 0):(this.errorTips("请输入正确的邮箱"),a.info.email="",void 0)}}))}function e(){n({el:g("#avatarHock"),btn:{width:150,height:50},call:function(a){a&&a.url&&g("#headIpt").attr("src",a.url)}})}function f(a){a.preventDefault();var b=this;b.nameIpt.blur(),b.emailItem&&b.emailItem.blur();var c=b.info.email,d=b.info.name;return d?!c&&b.needEmailOrPhone?(b.emailItem.errorTips("请输入正确的邮箱"),void 0):(j.completeness({body:{name:d},call:function(){return b.needEmailOrPhone?i.isEmail(c)?(k.updateEmail({body:{email:c},call:function(){window.location.href="/register/send-bind-email"},error:function(a){m.alert(a.msg)}}),void 0):(k.validatePhone({body:{phone:c},call:function(){window.location.href="/register/send-bind-phone"},error:function(a){m.alert(a.msg)}}),void 0):(window.location.href="/register/send-activited-email",void 0)},error:function(a){b.nameItem.errorTips(a.name||a.msg)}}),void 0):(b.nameItem.errorTips("起一个响亮的名字吧"),void 0)}var g=a("../../lib/jquery"),h=a("../../core/base"),i=a("../../util/util"),j=a("../../action/login"),k=a("../../action/profile"),l=a("../../component/input"),m=a("../../component/popup"),n=a("../../util/avatarUpload");h.ready({initialize:b,binds:{"click #submitBtn":f},initNameIpt:c,initEmailIpt:d,initAvatar:e})});
